name: Sovereign Finality ORB Bot

on:
  schedule:
    # Run at 14:25 UTC (GMT) every Monday through Friday
    - cron: '25 14 * * 1-5'
  workflow_dispatch: # Allow manual trigger

concurrency: 
  group: orb_bot_run
  cancel-in-progress: true

jobs:
  orb-engine:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Needed for pushing state updates
      
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }} # Use default token or PAT if pushing to protected branch
          
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install Dependencies
        run: |
          pip install requests yfinance pandas
          
      - name: Run Sovereign Finality Bot
        env:
          T212_API_KEY: ${{ secrets.T212_API_KEY }}
          T212_API_SECRET: ${{ secrets.T212_API_SECRET }}
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          # GITHUB_TOKEN is automatically verified for push if permissions are set
        run: python main_bot.py
