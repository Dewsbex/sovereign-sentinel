# Sovereign Sentinel (ORB Engine) - Master System Specification (v32.46)

## 1. System Overview
**Name**: Sovereign Sentinel (ORB Engine)
**Version**: v32.46 (Production)
**Objective**: Autonomous Opening Range Breakout (ORB) trading bot for Trading 212, integrated with a high-fidelity dashboard ("Vibe-folio").
**Core Tech Stack**:
- **Engine**: Python 3.10
- **Broker API**: Trading 212 API v0 (REST)
- **Market Data**: YFinance (RVOL), T212 (Live Pricing)
- **Frontend**: HTML5, Tailwind CSS, ApexCharts.js, Jinja2 Templating
- **Orchestration**: GitHub Actions (Cron Schedule)
- **State Management**: JSON-based Persistence (Git as Database)

---

## 2. Project Architecture

### 2.1 File Structure
The application requires the following exact directory structure:

```text
Sovereign-Sentinel/
├── .github/
│   └── workflows/
│       └── deployment.yml       # Cron Schedule & Secrets Injection (Job Runner)
├── config/
│   ├── orb_config.json          # Strategy Parameters (Risk, Watchlist)
│   └── config.py                # Python Config Loader
├── data/
│   ├── ledger_state.json        # MASTER DB: Equity, Positions, P/L (Generated by Job A)
│   ├── orb_intel.json           # INTELLIGENCE: AI Briefing Data (Manual/External Input)
│   └── watchlist.json           # SNIPER: Watchlist Targets
├── static/
│   └── sentinel_crest.png       # Dashboard Asset (Center of Donut)
├── templates/
│   └── base.html                # Jinja2 Dashboard Template (Contains CSS/JS)
├── main_bot.py                  # Entry Point (Orchestrator)
├── generate_isa_portfolio.py    # JOB A: The Auditor (Data Sync & Normalization)
├── generate_static.py           # JOB B: The Artist (UI Generation)
├── orb_execution.py             # Trade Execution Module
├── orb_shield.py                # Risk Management Module (OCO Bracket)
├── orb_observer.py              # Market Data Module (RVOL)
├── utilities/
│   ├── fetch_intelligence.py    # (Optional) Standalone Intelligence Fetcher
│   └── sniper_intelligence.py   # (Optional) Standalone Signal Logic
└── requirements.txt             # Python Dependencies
```

### 2.2 Dependencies (`requirements.txt`)
Exact package list required for replication:
```text
requests
jinja2
feedparser
yfinance
python-dotenv
pandas
websocket-client
alpha-vantage
```

---

## 3. Configuration & Data Schemas

### 3.1 Strategy Config (`config/orb_config.json`)
Controls the trading logic.
```json
{
    "risk": {
        "initial_capital": 1000.0,
        "max_drawdown_percent": 10.0,
        "trade_allocation_percent": 35.0
    },
    "filters": {
        "min_rvol": 1.5,
        "index_ticker": "SPY"
    },
    "watchlist": ["TSLA", "NVDA", "AMD", "PLTR", "COIN"]
}
```

### 3.2 Intelligence Schema (`data/orb_intel.json`)
Populates the "Operational Intelligence" UI. Currently populated manually or by external scripts.
```json
{
    "type": "MORNING VALIDATOR",
    "timestamp": "08:00 UTC",
    "headline": "Market Volatility Detected",
    "body": "CPI Data suggests inflation cooling. Tech sector rotation likely.",
    "status_color": "text-emerald-500",
    "context": "Pre-Market Scan"
}
```

---

## 4. Process Lifecycle (The "Sovereign Loop")

The system runs two distinct jobs: **Auditor (Data)** and **Artist (UI)**.

### Phase 1: The Auditor (`generate_isa_portfolio.py`)
- **Role**: Backend Sync.
- **Input**: T212 API, YFinance (FX Rates).
- **Process**:
    1.  Fetches all positions.
    2.  **Normalizes UK Assets**: Divides price by 100 (Pence to Pounds).
    3.  **Generates Sniper Data**: Checks `watchlist.json` against `yfinance` live prices.
    4.  **Saves State**: Writes to `data/ledger_state.json`.

### Phase 2: The Artist (`generate_static.py`)
- **Role**: Static Site Generator.
- **Input**: `ledger_state.json`, `orb_intel.json`.
- **Process**:
    1.  **Donut Engine**: Calculates SVG leader lines using trigonometry (Cos/Sin) to avoid label overlap.
    2.  **Heatmap Engine**: Aggregates sector data for ApexCharts.
    3.  **Vibe Check**: Injects "Pulse" animation class based on Market Hours (09:30-21:30 GMT).
- **Output**: `index.html`.

### Phase 3: The Sentinel (`main_bot.py`)
- **Role**: Execution Engine (Daily Cron).
- **Process**:
    1.  **Observation**: Checks RVOL > 1.5 (via `orb_observer.py`).
    2.  **Execution**: Trades Breakouts (via `orb_execution.py`).
    3.  **Shielding**: Sets OCO Stops (via `orb_shield.py`).

---

## 5. Pixel-Perfect UI Specification

### 5.1 Critical CSS (`templates/base.html`)
The "Live Pulse" effect is hardcoded in CSS, not Tailwind.

```css
@keyframes pulse-green {
    0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
    70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }
    100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
}
.live-badge { animation: pulse-green 2s infinite; }
```

### 5.2 Mathematical Logic (The "Auditor's Truth")
- **Truncation vs Rounding**: The UI uses `math.floor(val * 100) / 100` for display. Never round up.
- **Weight Calculation**: `(Position Value / (Total Net Equity - Cash)) * 100`.

---

## 6. Automation Reference

### 6.1 Verified API Config (Trading 212 v0)
- **Base URL**: `https://live.trading212.com/api/v0/equity`
- **Orders**:
    - **Market**: `POST /orders/market` (`ticker`, `signed_quantity`)
    - **Limit**: `POST /orders/limit` (`timeValidity="GTC"`)

### 6.2 GitHub Actions (`deployment.yml`)
- **Schedule**: `25 14 * * 1-5` (Mon-Fri)
- **Secrets**: `T212_API_KEY`, `T212_API_SECRET`, `TELEGRAM_TOKEN`, `TELEGRAM_CHAT_ID`

---

## 7. Replication Checklist
1.  [ ] **Clone Repo** & Layout Directory (Sec 2.1).
2.  [ ] **Install Requirements** (Sec 2.2).
3.  [ ] **Create Configs**: `orb_config.json`, `watchlist.json`.
4.  [ ] **Create Dummy Intel**: `data/orb_intel.json` (Sec 3.2).
5.  [ ] **Add Asset**: `static/sentinel_crest.png`.
6.  [ ] **Deploy**: Push to GitHub, Set Secrets, Enable Actions.
7.  [ ] **Run Job A**: `python generate_isa_portfolio.py` (Generate DB).
8.  [ ] **Run Job B**: `python generate_static.py` (Generate UI).
